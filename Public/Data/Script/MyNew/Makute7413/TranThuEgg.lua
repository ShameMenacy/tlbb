--ÕäÊŞµ°

--½Å±¾ºÅ
x887778_g_scriptId = 887778

x887778_g_petList = {};
	x887778_g_petList[32000001] = {type = 1, dataId = 3299, level = 1}
	x887778_g_petList[32000002] = {type = 1, dataId = 3319, level = 1}
	x887778_g_petList[32000003] = {type = 1, dataId = 3329, level = 1}
	x887778_g_petList[32000004] = {type = 1, dataId = 3349, level = 1}
	x887778_g_petList[32000005] = {type = 1, dataId = 7569, level = 1}
	x887778_g_petList[32000006] = {type = 1, dataId = 7639, level = 1}
	x887778_g_petList[32000007] = {type = 1, dataId = 7709, level = 1}
	x887778_g_petList[32000008] = {type = 1, dataId = 7779, level = 1}
	x887778_g_petList[32000009] = {type = 1, dataId = 7849, level = 1}
	x887778_g_petList[32000010] = {type = 1, dataId = 7919, level = 1}
	x887778_g_petList[32000011] = {type = 1, dataId = 7989, level = 1}
	x887778_g_petList[32000012] = {type = 1, dataId = 8059, level = 1}
	x887778_g_petList[32000013] = {type = 1, dataId = 8129, level = 1}
	x887778_g_petList[32000014] = {type = 1, dataId = 8189, level = 1}
	x887778_g_petList[32000015] = {type = 1, dataId = 8199, level = 1}
	x887778_g_petList[32000016] = {type = 1, dataId = 8269, level = 1}
	x887778_g_petList[32000017] = {type = 1, dataId = 8339, level = 1}
	x887778_g_petList[32000018] = {type = 1, dataId = 8409, level = 1}
	x887778_g_petList[32000019] = {type = 1, dataId = 8479, level = 1}
	x887778_g_petList[32000020] = {type = 1, dataId = 8549, level = 1}
	x887778_g_petList[32000021] = {type = 1, dataId = 8629, level = 1}
	x887778_g_petList[32000022] = {type = 1, dataId = 8699, level = 1}
	x887778_g_petList[32000023] = {type = 1, dataId = 8739, level = 1}
	x887778_g_petList[32000024] = {type = 1, dataId = 8809, level = 1}
	x887778_g_petList[32000025] = {type = 1, dataId = 8879, level = 1}
	x887778_g_petList[32000026] = {type = 1, dataId = 8949, level = 1}
	x887778_g_petList[32000027] = {type = 1, dataId = 22069, level = 1}
	x887778_g_petList[32000028] = {type = 1, dataId = 22139, level = 1}
	x887778_g_petList[32000029] = {type = 1, dataId = 22279, level = 1}
	x887778_g_petList[32000030] = {type = 1, dataId = 22349, level = 1}
	x887778_g_petList[32000031] = {type = 1, dataId = 22419, level = 1}
	x887778_g_petList[32000032] = {type = 1, dataId = 22489, level = 1}
	x887778_g_petList[32000033] = {type = 1, dataId = 22559, level = 1}
	x887778_g_petList[32000034] = {type = 1, dataId = 22579, level = 1}
	x887778_g_petList[32000035] = {type = 1, dataId = 22649, level = 1}
	x887778_g_petList[32000036] = {type = 1, dataId = 22719, level = 1}
	x887778_g_petList[32000037] = {type = 1, dataId = 22789, level = 1}
	x887778_g_petList[32000038] = {type = 1, dataId = 22859, level = 1}
	x887778_g_petList[32000039] = {type = 1, dataId = 22929, level = 1}
	x887778_g_petList[32000040] = {type = 1, dataId = 23009, level = 1}
	x887778_g_petList[32000041] = {type = 1, dataId = 23039, level = 1}
	x887778_g_petList[32000042] = {type = 1, dataId = 23109, level = 1}
	x887778_g_petList[32000043] = {type = 1, dataId = 23179, level = 1}
	x887778_g_petList[32000044] = {type = 1, dataId = 23249, level = 1}
	x887778_g_petList[32000045] = {type = 1, dataId = 23319, level = 1}
	x887778_g_petList[32000046] = {type = 1, dataId = 23329, level = 1}
	x887778_g_petList[32000047] = {type = 1, dataId = 23399, level = 1}
	x887778_g_petList[32000048] = {type = 1, dataId = 23469, level = 1}
	x887778_g_petList[32000049] = {type = 1, dataId = 23559, level = 1}
	x887778_g_petList[32000050] = {type = 1, dataId = 23629, level = 1}
	x887778_g_petList[32000051] = {type = 1, dataId = 23699, level = 1}
	x887778_g_petList[32000052] = {type = 1, dataId = 23779, level = 1}
	x887778_g_petList[32000053] = {type = 1, dataId = 23839, level = 1}
	x887778_g_petList[32000054] = {type = 1, dataId = 23909, level = 1}
	x887778_g_petList[32000055] = {type = 1, dataId = 24049, level = 1}
	x887778_g_petList[32000056] = {type = 1, dataId = 24119, level = 1}
	x887778_g_petList[32000057] = {type = 1, dataId = 24189, level = 1}
	x887778_g_petList[32000058] = {type = 1, dataId = 24259, level = 1}
	x887778_g_petList[32000059] = {type = 1, dataId = 24329, level = 1}
	x887778_g_petList[32000060] = {type = 1, dataId = 24399, level = 1}
	x887778_g_petList[32000061] = {type = 1, dataId = 24469, level = 1}
	x887778_g_petList[32000062] = {type = 1, dataId = 24579, level = 1}
	x887778_g_petList[32000063] = {type = 1, dataId = 24649, level = 1}
	x887778_g_petList[32000064] = {type = 1, dataId = 24659, level = 1}
	x887778_g_petList[32000065] = {type = 1, dataId = 24729, level = 1}
	x887778_g_petList[32000066] = {type = 1, dataId = 24799, level = 1}
	x887778_g_petList[32000067] = {type = 1, dataId = 27069, level = 1}
	x887778_g_petList[32000068] = {type = 1, dataId = 27139, level = 1}
	x887778_g_petList[32000069] = {type = 1, dataId = 27209, level = 1}
	x887778_g_petList[32000070] = {type = 1, dataId = 27289, level = 1}
	x887778_g_petList[32000071] = {type = 1, dataId = 27349, level = 1}
	x887778_g_petList[32000072] = {type = 1, dataId = 27419, level = 1}
	x887778_g_petList[32000073] = {type = 1, dataId = 27489, level = 1}
	x887778_g_petList[32000074] = {type = 1, dataId = 27559, level = 1}
	x887778_g_petList[32000075] = {type = 1, dataId = 27709, level = 1}
	x887778_g_petList[32000076] = {type = 1, dataId = 27719, level = 1}
	x887778_g_petList[32000077] = {type = 1, dataId = 27729, level = 1}
	x887778_g_petList[32000078] = {type = 1, dataId = 27739, level = 1}
	x887778_g_petList[32000079] = {type = 1, dataId = 27819, level = 1}
	x887778_g_petList[32000080] = {type = 1, dataId = 27969, level = 1}
	x887778_g_petList[32000081] = {type = 1, dataId = 28039, level = 1}
	x887778_g_petList[32000082] = {type = 1, dataId = 28109, level = 1}
	x887778_g_petList[32000083] = {type = 1, dataId = 28179, level = 1}
	x887778_g_petList[32000084] = {type = 1, dataId = 28249, level = 1}
	x887778_g_petList[32000085] = {type = 1, dataId = 28319, level = 1}
	x887778_g_petList[32000086] = {type = 1, dataId = 28399, level = 1}
	x887778_g_petList[32000087] = {type = 1, dataId = 28469, level = 1}
	x887778_g_petList[32000088] = {type = 1, dataId = 28539, level = 1}
	x887778_g_petList[32000089] = {type = 1, dataId = 28609, level = 1}
	x887778_g_petList[32000090] = {type = 1, dataId = 28679, level = 1}
	x887778_g_petList[32000091] = {type = 1, dataId = 29379, level = 1}
	x887778_g_petList[32000092] = {type = 1, dataId = 29449, level = 1}
	x887778_g_petList[32000093] = {type = 1, dataId = 29529, level = 1}
	x887778_g_petList[32000094] = {type = 1, dataId = 29609, level = 1}
	x887778_g_petList[32000095] = {type = 1, dataId = 29679, level = 1}
	x887778_g_petList[32000096] = {type = 1, dataId = 29749, level = 1}
	x887778_g_petList[32000097] = {type = 1, dataId = 29819, level = 1}
	x887778_g_petList[32000098] = {type = 1, dataId = 29889, level = 1}
	x887778_g_petList[32000099] = {type = 1, dataId = 29959, level = 1}
	x887778_g_petList[32000100] = {type = 1, dataId = 30039, level = 1}
	x887778_g_petList[32000101] = {type = 1, dataId = 30109, level = 1}
	x887778_g_petList[32000102] = {type = 1, dataId = 30179, level = 1}
	x887778_g_petList[32000103] = {type = 1, dataId = 30249, level = 1}
	x887778_g_petList[32000104] = {type = 1, dataId = 30319, level = 1}
	x887778_g_petList[32000105] = {type = 1, dataId = 30389, level = 1}

--**********************************
-- ·µ»Ø1£º¼¼ÄÜÀàËÆµÄÎïÆ·£¬¿ÉÒÔ¼ÌĞøÀàËÆ¼¼ÄÜµÄÖ´ĞĞ£»·µ»Ø0£ºÖ´ĞĞ OnDefaultEvent¡£
--**********************************
function x887778_IsSkillLikeScript( sceneId, selfId )
	return 1
end

--**********************************
-- ·µ»Ø1£ºÒÑ¾­È¡Ïû¶ÔÓ¦Ğ§¹û£¬²»ÔÙÖ´ĞĞºóĞø²Ù×÷£»·µ»Ø0£ºÃ»ÓĞ¼ì²âµ½Ïà¹ØĞ§¹û£¬¼ÌĞøÖ´ĞĞ¡£
--**********************************
function x887778_CancelImpacts( sceneId, selfId )
	return 0
end

--**********************************
-- Ìõ¼ş¼ì²âÈë¿Ú£º·µ»Ø1£ºÌõ¼ş¼ì²âÍ¨¹ı£¬¿ÉÒÔ¼ÌĞøÖ´ĞĞ£»·µ»Ø0£ºÌõ¼ş¼ì²âÊ§°Ü£¬ÖĞ¶ÏºóĞøÖ´ĞĞ¡£
--**********************************
function x887778_OnConditionCheck( sceneId, selfId )
	-- Ğ£ÑéÊ¹ÓÃµÄÎïÆ·
	if LuaFnVerifyUsedItem( sceneId, selfId ) ~= 1 then
		return 0
	end

	local checkCreatePet = TryCreatePet(sceneId, selfId, 1);
	if not checkCreatePet or checkCreatePet ~= 1 then
		x887778_NotifyFailTips(sceneId, selfId, "Các hÕ không th¬ mang theo quá nhi«u trân thú!");
		return 0;
	end

	local itemTblIndex = LuaFnGetItemIndexOfUsedItem( sceneId, selfId );
	local petItem = x887778_g_petList[itemTblIndex];
	if not petItem then
		x887778_NotifyFailTips(sceneId, selfId, "ĞÕo cø chßa m·, không th¬ sØ døng.");
		return 0;
	end
	
	if petItem.type ~= 2 then
	local takeLevel = GetPetTakeLevel(petItem.dataId);
	local humanLevel = LuaFnGetLevel(sceneId, selfId);
	if not takeLevel or not humanLevel or takeLevel > humanLevel then
		x887778_NotifyFailTips(sceneId, selfId, "ĞÆng c¤p cüa các hÕ không ğü ğ¬ mang theo trân thú!");
		return 0;
	end
	end
	return 1
end

--**********************************
--ÏûºÄ¼ì²â¼°´¦ÀíÈë¿Ú£¬¸ºÔğÏûºÄµÄ¼ì²âºÍÖ´ĞĞ£º
--·µ»Ø1£ºÏûºÄ´¦ÀíÍ¨¹ı£¬¿ÉÒÔ¼ÌĞøÖ´ĞĞ£»·µ»Ø0£ºÏûºÄ¼ì²âÊ§°Ü£¬ÖĞ¶ÏºóĞøÖ´ĞĞ¡£
--**********************************
function x887778_OnDeplete( sceneId, selfId )
	return 1
end

--**********************************
--Ö»»áÖ´ĞĞÒ»´ÎÈë¿Ú£º
--¾ÛÆøºÍË²·¢¼¼ÄÜ»áÔÚÏûºÄÍê³Éºóµ÷ÓÃÕâ¸ö½Ó¿Ú£¨¾ÛÆø½áÊø²¢ÇÒ¸÷ÖÖÌõ¼ş¶¼Âú×ãµÄÊ±ºò£©£¬¶øÒıµ¼
--¼¼ÄÜÒ²»áÔÚÏûºÄÍê³Éºóµ÷ÓÃÕâ¸ö½Ó¿Ú£¨¼¼ÄÜµÄÒ»¿ªÊ¼£¬ÏûºÄ³É¹¦Ö´ĞĞÖ®ºó£©¡£
--·µ»Ø1£º´¦Àí³É¹¦£»·µ»Ø0£º´¦ÀíÊ§°Ü¡£
--×¢£ºÕâÀïÊÇ¼¼ÄÜÉúĞ§Ò»´ÎµÄÈë¿Ú
--**********************************
function x887778_OnActivateOnce( sceneId, selfId )

	--É¾³ıÇ°±£´æTrans....
	local BagIndex = LuaFnGetBagIndexOfUsedItem(sceneId, selfId)
	local ItemInfo = GetBagItemTransfer( sceneId, selfId, BagIndex )

	if LuaFnDepletingUsedItem( sceneId, selfId ) <= 0 then
		return 0
	end

	local itemTblIndex = LuaFnGetItemIndexOfUsedItem( sceneId, selfId );
	local petItem = x887778_g_petList[itemTblIndex];
	if not petItem then
		x887778_NotifyFailTips(sceneId, selfId, "ĞÕo cø chßa m·, không th¬ sØ døng.");
		return 0;
	end

	local petGUID_H = 0
	local petGUID_L = 0
	local ret = -1

	if petItem.type == 1 then
		ret, petGUID_H, petGUID_L = CallScriptFunction( 800105, "CreateRMBPetToHuman", sceneId, selfId, petItem.dataId, petItem.level);
		if ret and ret == 1 then
			x887778_OnGivePlayerPet( sceneId, selfId, petItem.dataId, petGUID_H, petGUID_L, ItemInfo )
		end
	elseif petItem.type == 2 then
		local level = GetLevel( sceneId, selfId );
	  for i,pet in petItem.dataIds do
	  	if level >=pet.minHumanLevel and level <= pet.maxHumanLevel then
			  	ret = CallScriptFunction( 800105, "CreateRMBPetToHuman", sceneId, selfId, pet.dataId, petItem.level);
					if ret and ret == 1 then
						x887778_OnGivePlayerPet( sceneId, selfId, pet.dataId, petGUID_H, petGUID_L, ItemInfo )
					end
	  	end
	  end
	else
	    ret, petGUID_H, petGUID_L = LuaFnCreatePetToHuman(sceneId, selfId, petItem.dataId, petItem.level, 0);
	    if ret and ret == 1 then
				x887778_OnGivePlayerPet( sceneId, selfId, petItem.dataId, petGUID_H, petGUID_L, ItemInfo )
			end
	end
	return 1
end

--**********************************
--Òıµ¼ĞÄÌø´¦ÀíÈë¿Ú£º
--Òıµ¼¼¼ÄÜ»áÔÚÃ¿´ÎĞÄÌø½áÊøÊ±µ÷ÓÃÕâ¸ö½Ó¿Ú¡£
--·µ»Ø£º1¼ÌĞøÏÂ´ÎĞÄÌø£»0£ºÖĞ¶ÏÒıµ¼¡£
--×¢£ºÕâÀïÊÇ¼¼ÄÜĞÄÌøÊ±ÉúĞ§µÄÈë¿Ú
--**********************************
function x887778_OnActivateEachTick( sceneId, selfId )
	return 1
end

--**********************************
-- ĞÑÄ¿Ê§°ÜÌáÊ¾
--**********************************
function x887778_NotifyFailTips( sceneId, selfId, Tip )
	BeginEvent( sceneId )
		AddText( sceneId, Tip )
	EndEvent( sceneId )
	DispatchMissionTips( sceneId, selfId )
end


function x887778_OnGivePlayerPet( sceneId, selfId, petId, petGUID_H, petGUID_L, ItemInfo )

	local petName = GetPetName( petId )
	if petName then
		x887778_NotifyFailTips(sceneId, selfId, "Chúc m×ng các hÕ ğã ğÕt ğßşc "..petName.."!")
	end

	LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId, 18, 0)

end
